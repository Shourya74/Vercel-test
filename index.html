<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ORCUS - A Tool Room Management System</title>

  <link href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.8.2/css/bulma.min.css">
  <!-- <script src="https://firebasestorage.googleapis.com/v0/b/orcus-fb184.appspot.com/o/release%2Fservice-layer.js?alt=media&token=50818057-52fa-4c7e-b28b-efd29f03b991"></script>  -->

  <!-- for local development -->
  <script src="common.js"></script>

  <!-- for production -->
  <!-- <script src="https://firebasestorage.googleapis.com/v0/b/orcus-fb184.appspot.com/o/release%2Fcommon.js?alt=media&token=6dc6c1af-e542-47bf-be33-a53dae858494"></script> -->


  <!-- for production -->
  <!-- <link rel="stylesheet" type="text/css" href="https://firebasestorage.googleapis.com/v0/b/orcus-fb184.appspot.com/o/release%2Fcommonstyles.css?alt=media&token=d51867a1-9f00-4f5a-9c9e-630db97054ab"  /> -->
  <!-- for local -->
  <link rel="stylesheet" type="text/css" href="./commonstyles.css">

</head>

<body>

  <div id="create-account-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header style="background-color: 	#ffdd57;" class="modal-card-head">
        <p style="color: black;" class="modal-card-title">Sign Up</p>
        <button onclick="closeModal()" class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <div class="field">
          <label class="label">First Name</label>
          <div class="control has-icons-right">
            <input id="first-name-input" class="input" type="text" placeholder="Rajesh" required>
            <span style="display: none;" id="first-name-check" class="icon is-small is-right">
              <i class="fas fa-check"></i>
            </span>
            <span style="display: none;" id="first-name-exclaimation" class="icon is-small is-right">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
          </div>
        </div>


        <div class="field">
          <label class="label">Last Name</label>
          <div class="control has-icons-right">
            <input id="last-name-input" class="input" type="text" placeholder="Sharma">
            <span style="display: none;" id="last-name-check" class="icon is-small is-right">
              <i class="fas fa-check"></i>
            </span>
            <span style="display: none;" id="last-name-exclaimation" class="icon is-small is-right">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
          </div>
        </div>
        <!-- <div class="field">
          <label class="label">Company Name</label>
          <div class="control has-icons-left has-icons-right">
            <input id="company-input" class="input" type="email" placeholder="Company Unique ID" >
            <span class="icon is-small is-left">
              <i class="fas fa-user"></i>
            </span>
            <span style="display: none;" id="company-exclaimation" class="icon is-small is-right">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
            <span style="display: none;" id="company-check" class="icon is-small is-right">
              <i class="fas fa-check"></i>
            </span>
          </div>
          <p id="company-input-error-message" class="help is-danger"></p>
          <p id="company-input-success-message" class="help is-success"></p>
        </div> -->
        <!-- <div class="field">
          <label class="label">Company Name</label>
          <div class="control has-icons-right">
            <div class="select">
              <select id="company-select">
                <option value="" disabled selected hidden>Select Company</option>
                <option>Skoda</option>
                <option>Ford</option>
                <option>Hyundai</option>
                <option>Volkswagen</option>
                <option>Maruti Suzuki</option>
                <option>Kia</option>
                <option>Tata Motors</option>
                <option>GM</option>
                <option>Skoda</option>
              </select>
            </div>
          </div>
          <p id="company-input-error-message" class="help is-danger"></p>
          <p id="company-input-success-message" class="help is-success"></p>
        </div> -->

        <div class="field">
          <label class="label">Workshop ID</label>
          <div class="control has-icons-left has-icons-right">
            <input id="workshop-input" class="input" type="email" placeholder="Worksop Unique ID">
            <span class="icon is-small is-left">
              <i class="fas fa-user"></i>
            </span>
            <span style="display: none;" id="workshop-exclaimation" class="icon is-small is-right">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
            <span style="display: none;" id="workshop-check" class="icon is-small is-right">
              <i class="fas fa-check"></i>
            </span>
          </div>
          <p id="workshop-input-error-message" class="help is-danger"></p>
          <p id="workshop-input-success-message" class="help is-success"></p>
        </div>

        <div class="field">
          <label class="label">Email</label>
          <div class="control has-icons-left has-icons-right">
            <input id="email-input" class="input" type="email" placeholder="user@example.com">
            <span class="icon is-small is-left">
              <i class="fas fa-envelope"></i>
            </span>
            <span style="display: none;" id="email-exclaimation" class="icon is-small is-right">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
            <span style="display: none;" id="email-check" class="icon is-small is-right">
              <i class="fas fa-check"></i>
            </span>
          </div>
          <p id="email-input-error-message" class="help is-danger"></p>
          <p id="email-input-success-message" class="help is-success"></p>
        </div>

        <div class="field">
          <label class="label">Password</label>
          <div class="control has-icons-left has-icons-right">
            <input id="password-input" class="input" type="password" placeholder="********">
            <span class="icon is-small is-left">
              <i class="fas fa-lock"></i>
            </span>
            <span style="display: none;" id="password-exclaimation" class="icon is-small is-right">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
            <span style="display: none;" id="password-check" class="icon is-small is-right">
              <i class="fas fa-check"></i>
            </span>
          </div>
          <p id="password-input-error-message" class="help is-danger"></p>
        </div>

        <div class="field">
          <label class="label"> Confirm Password</label>
          <div class="control has-icons-left has-icons-right">
            <input id="confirm-password-input" class="input" type="password" placeholder="********">
            <span class="icon is-small is-left">
              <i class="fas fa-lock"></i>
            </span>
            <span style="display: none;" id="confirm-password-exclaimation" class="icon is-small is-right">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
            <span style="display: none;" id="confirm-password-check" class="icon is-small is-right">
              <i class="fas fa-check"></i>
            </span>
          </div>
          <p id="confirm-password-input-error-message" class="help is-danger"></p>
        </div>

        <div class="field">
          <label class="label">Contact Number</label>
          <div class="field-body">
            <div class="field is-expanded">
              <div class="field has-addons">
                <p class="control">
                  <a class="button is-static">
                    +91
                  </a>
                </p>
                <p class="control is-expanded has-icons-right">
                  <input id="contact-number-input" class="input" type="tel" placeholder="9876543210" required>
                  <span style="display: none;" id="contact-number-exclaimation" class="icon is-small is-right">
                    <i class="fas fa-exclamation-triangle"></i>
                  </span>
                  <span style="display: none;" id="contact-number-check" class="icon is-small is-right">
                    <i class="fas fa-check"></i>
                  </span>
                </p>
              </div>
              <p id="contact-number-error-message" class="help is-danger"></p>
            </div>
          </div>
        </div>

        <div class="field">
          <label class="label">Date Of Birth</label>
          <div class="control has-icons-left has-icons-right">
            <input id="dob-input" class="input" type="date" min="1970-01-01" placeholder="Date Of Birth">
            <span class="icon is-small is-left">
              <i class="fas fa-birthday-cake"></i>
            </span>
            <span style="display: none;" id="dob-exclaimation" class="icon is-small is-right">
              <i class="fas fa-exclamation-triangle"></i>
            </span>
            <span style="display: none;" id="dob-check" class="icon is-small is-right">
              <i class="fas fa-check"></i>
            </span>
          </div>
          <p id="dob-error-message" class="help is-danger"></p>
        </div>



        <!-- <div class="field">
          <label class="label">Subject</label>
          <div class="control">
            <div class="select">
              <select>
                <option>Select dropdown</option>
                <option>With options</option>
              </select>
            </div>
          </div>
        </div> -->

        <div class="field">
          <label class="label">Extra Message (optional)</label>
          <div class="control">
            <textarea id="extra-message-input" class="textarea"
              placeholder="Anything that you might want to mention to the approver."></textarea>
          </div>
        </div>

        <div class="field">
          <div class="control">
            <label class="checkbox">
              <input id="t&c-input" type="checkbox">
              I agree to the <a href="#">terms and conditions</a>
            </label>
          </div>
        </div>

        <!-- <div class="field">
          <div class="control">
            <label class="radio">
              <input type="radio" name="question">
              Yes
            </label>
            <label class="radio">
              <input type="radio" name="question">
              No
            </label>
          </div>
        </div> -->

        <div class="field is-grouped">
          <div class="control">
            <button onclick="signUp()" class="button is-warning">Sign Up</button>
          </div>
          <!-- <div class="control">
            <button onclick="clearSignUpForm()" class="button is-warning is-light">Cancel</button>
          </div> -->
        </div>
      </section>

    </div>
  </div>
  <div id="forgot-password-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header style="background-color: 	#ffdd57;" class="modal-card-head">
        <p style="color: black;" class="modal-card-title">Reset Password</p>
        <button onclick="closeModal()" class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <div class="field">
          <p>Please enter the following details for us to be able to identify you correctly.</p>
        </div>
        <div class="field">
          <label class="label">User ID</label>
          <div class="control has-icons-left has-icons-right">
            <input id="forgot-password-user-input" class="input" type="email" placeholder="User Unique ID">
            <span class="icon is-small is-left">
              <i class="fas fa-user"></i>
            </span>

          </div>

        </div>
        <div class="field">
          <label class="label">Email</label>
          <div class="control has-icons-left has-icons-right">
            <input id="forgot-password-email-input" class="input" type="email" placeholder="user@example.com">
            <span class="icon is-small is-left">
              <i class="fas fa-envelope"></i>
            </span>
          </div>
        </div>

        <div class="field">
          <label class="label">Date Of Birth</label>
          <div class="control has-icons-left has-icons-right">
            <input id="forgot-password-dob-input" class="input" type="date" min="1970-01-01"
              placeholder="Date Of Birth">
            <span class="icon is-small is-left">
              <i class="fas fa-birthday-cake"></i>
            </span>
          </div>
        </div>
        <div class="field is-grouped">
          <div class="control">
            <button onclick="resetPassword()" class="button is-warning">Reset Password</button>
          </div>
          <!-- <div class="control">
            <button onclick="clearSignUpForm()" class="button is-warning is-light">Cancel</button>
          </div> -->
        </div>

      </section>

    </div>
  </div>
  <div id="password-reset-confirmation-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header style="background-color: 	#ffdd57;" class="modal-card-head">
        <p style="color: black;" class="modal-card-title">Done</p>
        <button onclick="closeModal()" class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <div class="column">
          <div class="column is-12" style="text-align: center;">
            <i style="color: lightgreen; font-size: 5vw;" class="fa fa-check-circle" aria-hidden="true"></i>
          </div>
        </div>
        <div class="column">
          <div class="column is-12">
            <p>If your details match, you will recieve a mail with the new password. For any other queries, please
              contact the ORCUS Support Team.</p>
          </div>
        </div>
      </section>

    </div>
  </div>
  <div id="signup-request-confirmation-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header style="background-color: 	#ffdd57;" class="modal-card-head">
        <p style="color: black;" class="modal-card-title">Thank You!</p>
        <button onclick="closeModal()" class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body">
        <div class="column">
          <div class="column is-12" style="text-align: center;">
            <i style="color: lightgreen; font-size: 5vw;" class="fa fa-check-circle" aria-hidden="true"></i>
          </div>
        </div>
        <div class="column">
          <div class="column is-12">
            <p>We have recieved your request for account setup. Please wait for your manager to approve this request. We
              will send you a mail on approval. Until then, please note down your ID.<br>Your User ID is <b
                id="generated-uid-signup"></b>.</p>
          </div>
        </div>
      </section>

    </div>
  </div>
  <div id="alert-modal" class="modal">
    <div class="modal-background"></div>
    <div class="modal-card">
      <header style="background-color: #349cdc;" class="modal-card-head">
        <p style="color: white;" class="modal-card-title">Alert</p>
        <button onclick="closeModal()" class="delete" aria-label="close"></button>
      </header>
      <section class="modal-card-body" id="alert-modal-text">

      </section>

    </div>
  </div>
  <section style="margin-top: 1vh;overflow: hidden;">
    <div class="columns">
      <div class="column is-6" style="height: 100vh;">



        <form onsubmit="return false" style=" margin-top: 20vh;">

          <div class="columns is-centered is-mobile">

            <div class="column is-8">

              <h1 class="title">Login</h1>

            </div>
          </div>
          <div class="columns is-centered is-mobile">
            <div class="column is-8">
              <div class="field">
                <div id="error-message" class="notification is-warning is-light is-rounded"
                  style="text-align: center;display:none;">


                </div>
              </div>
            </div>
          </div>
          <div class="columns is-centered is-mobile">
            <div class="column is-8">

              <div class="field">
                <!-- <label class="label">Email</label> -->

                <div class="control has-icons-left has-icons-right">
                  <input class="input is-warning is-medium" id="usr" type="text" placeholder="ID/Email">
                  <span class="icon is-small is-left">
                    <i class="far fa-id-badge"></i>
                  </span>

                </div>
                <!-- <p class="help is-danger">This email is invalid</p> -->
              </div>

            </div>
          </div>
          <div class="columns is-centered is-mobile">
            <div class="column is-8">

              <div class="field">
                <!-- <label class="label">Email</label> -->
                <div class="control has-icons-left has-icons-right">

                  <input class="input is-warning is-medium" id="pswd" type="password" placeholder="Password">
                  <span class="icon is-small is-left">
                    <i class="fas fa-lock"></i>
                  </span>

                </div>
              </div>
            </div>
          </div>
          <div class="columns is-centered is-mobile">

            <div class="column is-8">


              <h1 class="subtitle is-6" style="float: right;"><a onclick="openForgotPasswordModal()">Forgot
                  Password?</a></h1>

            </div>
          </div>

          <div class="columns is-centered is-mobile">
            <div class="column is-8">
              <button type="submit" id="login" class="button is-warning is-medium" style="width: 100%;">Login</button>
            </div>
          </div>
          <div class="columns is-centered is-mobile">

            <div class="column is-8">


              <h1 class="subtitle is-6">Don't have an account? <a onclick="openCreateAccountModal()">Create Account</a>
              </h1>

            </div>
          </div>
        </form>

      </div>
      <div class="column is-8 clipbackground"
        style="border: solid white 1px;height: 100vh;clip-path: polygon(0 0, 100% 0, 100% 100%, 55% 100%);position: absolute;top: 0;right: 0;">
        <div class="columns is-centered" style="padding: 0;">
          <div class="column is-7 is-offset-4">
            <img
              src="https://firebasestorage.googleapis.com/v0/b/orcus-fb184.appspot.com/o/release%2Flogo-yellow-nobg.png?alt=media&token=94799321-75f8-4315-9cac-b4f007565bfb">
          </div>
        </div>
        <!-- <div class="columns is-centered" style="padding: 0;float: bottom;">

          <div class="column is-3">
            <p style="font-size: 5px;font-weight: bolder;text-align: center;">ORCUS</p>
          </div>
        </div> -->
      </div>
    </div>

    </div>
  </section>
  <h2 class="subtitle is-7"
    style="-webkit-user-select: none;position: absolute;bottom: 0;right: 1%;color: white;padding-bottom: 0px;">
    All rights reserved. Scorptech Technologies Pvt Ltd Â© 2020</h2>
  <button onclick="closeWindow()" class="fas fa-times closeButton" id="closebuttonsid" aria-label="close"></button>
  <button onclick="minimiseWindow()" class="fa fa-minus minimiseButton" id="minimisebuttonsid" aria-label="minimise"></button>
</body>
<script>

  const { remote } = require('electron')


  var checkIcon = document.createElement("span");
  checkIcon.className = "icon is-small is-right";
  var checkIconI = document.createElement("i");
  checkIconI.className = "fas fa-check";
  checkIcon.appendChild(checkIconI);


  var exclaimationIcon = document.createElement("span");
  exclaimationIcon.className = "icon is-small is-right";
  var exclaimationIconI = document.createElement("i");
  exclaimationIconI.className = "fas fa-check";
  exclaimationIcon.appendChild(exclaimationIconI);

  // uncomment this for local service layer
  var connectorClass = require("./service-layer.js");
  var cc = new connectorClass();

  //cc.getAllTechnicians(workshop_id);

  const { ipcRenderer } = require('electron');
  var cid;
  var moment = require('moment-timezone');
  var x = moment();
  x = x.format("YYYY-MM-DD HH:mm:ss").toString();
  console.log(x);
  y = moment();
  y.set("hours", 19);
  y.set("minutes", 0);
  y.set("seconds", 0);
  y = y.format("YYYY-MM-DD HH:mm:ss").toString();
  console.log(y);

  function closeWindow() {
    window.close();
  }
  function minimiseWindow() {
    remote.BrowserWindow.getFocusedWindow().minimize();
  }
  initiateSetup();
  async function initiateSetup() {
    try {
      var allCompanyIDs = await cc.getAllWorkshopDetails();
      cc.closeConnection();
      // document.getElementById("company-input").addEventListener("keyup", function (event){
      //   var entry = event.target.value;
      //   for(var i=0; i<allCompanyIDs.length; i++){
      //     if(entry == allCompanyIDs[i]["Company ID"]){
      //       event.target.classList.remove("is-danger");
      //       event.target.classList.add("is-success");
      //       document.getElementById("company-check").style.removeProperty("display");
      //       document.getElementById("company-exclaimation").style.display = "none";
      //       document.getElementById("company-input-success-message").innerHTML = "Company Verified!";
      //       document.getElementById("company-input-error-message").innerHTML = "";

      //       return;
      //     }
      //   }
      //     event.target.classList.remove("is-success");
      //     event.target.classList.add("is-danger");
      //     document.getElementById("company-check").style.display = "none";
      //     document.getElementById("company-exclaimation").style.removeProperty("display");
      //     document.getElementById("company-input-error-message").innerHTML = "We could not verify this company."
      //     document.getElementById("company-input-success-message").innerHTML = "";
      // });



      document.getElementById("workshop-input").addEventListener("keyup", function (event) {
        var entry = event.target.value;
        for (var i = 0; i < allCompanyIDs.length; i++) {
          if (entry == allCompanyIDs[i]["Workshop ID"]) {
            event.target.classList.remove("is-danger");
            event.target.classList.add("is-success");
            document.getElementById("workshop-check").style.removeProperty("display");
            document.getElementById("workshop-exclaimation").style.display = "none";
            document.getElementById("workshop-input-success-message").innerHTML = "Workshop Verified! : " + allCompanyIDs[i]["Workshop Name"];
            document.getElementById("workshop-input-error-message").innerHTML = "";
            cid = allCompanyIDs[i]["Company Name"];
            return;
          }
        }
        event.target.classList.remove("is-success");
        event.target.classList.add("is-danger");
        document.getElementById("workshop-check").style.display = "none";
        document.getElementById("workshop-exclaimation").style.removeProperty("display");
        document.getElementById("workshop-input-error-message").innerHTML = "We could not verify this workshop."
        document.getElementById("workshop-input-success-message").innerHTML = "";
        cid = "";
      });
    }
    catch (error) {
      alert1("Error in fetching your details! Please try again.");
      console.log("Error in fetching your details! Please try again.");
    }
    try {

      var allEmails = await cc.getAllRegisteredEmails();
      cc.closeConnection();
      var allEmailsArray = [];
      for (var i = 0; i < allEmails.length; i++) {
        allEmailsArray.push(allEmails[i]["Email"]);
      }
      document.getElementById("email-input").addEventListener("keyup", function (event) {
        var entry = event.target.value;
        var email = /^([A-Za-z0-9_\-\.])+\@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,4})$/;
        if (!email.test(entry)) {
          event.target.classList.remove("is-success");
          event.target.classList.add("is-danger");
          document.getElementById("email-check").style.display = "none";
          document.getElementById("email-exclaimation").style.removeProperty("display");
          // document.getElementById("email-input-error-message").innerHTML = "Please enter a valid email."
          document.getElementById("email-input-success-message").innerHTML = "";
        }
        else if (allEmailsArray.includes(entry)) {
          event.target.classList.remove("is-success");
          event.target.classList.add("is-danger");
          document.getElementById("email-check").style.display = "none";
          document.getElementById("email-exclaimation").style.removeProperty("display");
          document.getElementById("email-input-error-message").innerHTML = "You are an existing user. Please Login.";
          document.getElementById("email-input-success-message").innerHTML = "";
        }
        else {
          event.target.classList.remove("is-danger");
          event.target.classList.add("is-success");
          document.getElementById("email-check").style.removeProperty("display");
          document.getElementById("email-exclaimation").style.display = "none";
          document.getElementById("email-input-success-message").innerHTML = "Email Verified!";
          document.getElementById("email-input-error-message").innerHTML = "";
        }
      });
    }
    catch {
      alert1("Error in fetching your details! Please try again.");
      console.log("Error in getAllRegisteredEmails");
    }
  }


  var input = document.getElementById("pswd");
  input.addEventListener("keyup", function (event) {
    if (event.getModifierState("CapsLock") == true) {
      console.log(event.getModifierState("CapsLock"));
      document.getElementById("error-message").style.display = "inherit";
      document.getElementById("error-message").innerHTML = "Warning: Caps Lock is turned on.";
    } else if (event.getModifierState("CapsLock") == false) {
      if (document.getElementById("error-message").innerHTML == "Warning: Caps Lock is turned on.") {
        document.getElementById("error-message").style.display = "none";
        document.getElementById("error-message").innerHTML = "";
      }
    }
  });

  document.getElementById("login").addEventListener("click", loginButtonPressed);


  document.getElementById("dob-input").addEventListener("change", function (event) {
    var entry = event.target.value;

    if (!entry) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("dob-check").style.display = "none";
      document.getElementById("dob-exclaimation").style.removeProperty("display");
      document.getElementById("dob-error-message").innerHTML = "Please select your date of birth."
      // document.getElementById("email-input-success-message").innerHTML = "";
    }
    else {
      event.target.classList.remove("is-danger");
      event.target.classList.add("is-success");
      document.getElementById("dob-check").style.removeProperty("display");
      document.getElementById("dob-exclaimation").style.display = "none";
      // document.getElementById("email-input-success-message").innerHTML = "Email Verified!";
      document.getElementById("dob-error-message").innerHTML = "";
    }
  });
  document.getElementById("contact-number-input").addEventListener("keyup", function (event) {
    var entry = event.target.value;
    var phone = /^\d{10}$/;
    if (!phone.test(entry)) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("contact-number-check").style.display = "none";
      document.getElementById("contact-number-exclaimation").style.removeProperty("display");
      document.getElementById("contact-number-error-message").innerHTML = "Please enter a valid phone number."
      // document.getElementById("email-input-success-message").innerHTML = "";
    }
    else {
      event.target.classList.remove("is-danger");
      event.target.classList.add("is-success");
      document.getElementById("contact-number-check").style.removeProperty("display");
      document.getElementById("contact-number-exclaimation").style.display = "none";
      // document.getElementById("email-input-success-message").innerHTML = "Email Verified!";
      document.getElementById("contact-number-error-message").innerHTML = "";
    }
  });



  document.getElementById("password-input").addEventListener("keyup", function (event) {
    var entry = event.target.value;
    if (entry.length < 6 || entry.length > 20) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("password-check").style.display = "none";
      document.getElementById("password-exclaimation").style.removeProperty("display");
      document.getElementById("password-input-error-message").innerHTML = "Password should be between 6 and 20 characters.";
      event.target.focus();

      return false;
    }
    re = /[0-9]/;
    if (!re.test(entry)) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("password-check").style.display = "none";
      document.getElementById("password-exclaimation").style.removeProperty("display");
      document.getElementById("password-input-error-message").innerHTML = "Password should contain a number (0-9)";
      event.target.focus();
      return false;
    }
    re = /[a-z]/;
    if (!re.test(entry)) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("password-check").style.display = "none";
      document.getElementById("password-exclaimation").style.removeProperty("display");
      document.getElementById("password-input-error-message").innerHTML = "Password should contain atleast one letter (a-z)";
      event.target.focus();
      return false;
    }
    re = /[A-Z]/;
    if (!re.test(entry)) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("password-check").style.display = "none";
      document.getElementById("password-exclaimation").style.removeProperty("display");
      document.getElementById("password-input-error-message").innerHTML = "Password should contain atleast one capital letter.";
      event.target.focus();
      return false;
    }

    event.target.classList.remove("is-danger");
    event.target.classList.add("is-success");
    document.getElementById("password-check").style.removeProperty("display");
    document.getElementById("password-exclaimation").style.display = "none";
    document.getElementById("password-input-error-message").innerHTML = "";
  });

  document.getElementById("confirm-password-input").addEventListener("keyup", function (event) {
    var entry = event.target.value;
    if ((entry != document.getElementById("password-input").value)) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("confirm-password-check").style.display = "none";
      document.getElementById("confirm-password-exclaimation").style.removeProperty("display");
      document.getElementById("confirm-password-input-error-message").innerHTML = "Please make sure that the passwords match.";
      event.target.focus();
      return false;
    }
    if (!(document.getElementById("password-input").className.includes("is-success"))) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("confirm-password-check").style.display = "none";
      document.getElementById("confirm-password-exclaimation").style.removeProperty("display");
      document.getElementById("confirm-password-input-error-message").innerHTML = "Passwords don't match the requirement.";
      event.target.focus();
      return false;
    }
    event.target.classList.remove("is-danger");
    event.target.classList.add("is-success");
    document.getElementById("confirm-password-check").style.removeProperty("display");
    document.getElementById("confirm-password-exclaimation").style.display = "none";
    document.getElementById("confirm-password-input-error-message").innerHTML = "";
  });


  document.getElementById("first-name-input").addEventListener("keyup", function (event) {
    var firstName = /^[a-zA-Z]+$/;
    var entry = event.target.value;
    if (!firstName.test(entry)) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("first-name-check").style.display = "none";
      document.getElementById("first-name-exclaimation").style.removeProperty("display");
    }
    else {
      event.target.classList.remove("is-danger");
      event.target.classList.add("is-success");
      document.getElementById("first-name-check").style.removeProperty("display");
      document.getElementById("first-name-exclaimation").style.display = "none";
    }
  });



  document.getElementById("last-name-input").addEventListener("keyup", function (event) {
    var firstName = /^[a-zA-Z]+$/;
    var entry = event.target.value;
    if (!firstName.test(entry)) {
      event.target.classList.remove("is-success");
      event.target.classList.add("is-danger");
      document.getElementById("last-name-check").style.display = "none";
      document.getElementById("last-name-exclaimation").style.removeProperty("display");
    }
    else {
      event.target.classList.remove("is-danger");
      event.target.classList.add("is-success");
      document.getElementById("last-name-check").style.removeProperty("display");
      document.getElementById("last-name-exclaimation").style.display = "none";
    }
  });

  async function resetPassword() {
    id = document.getElementById("forgot-password-user-input").value;
    email = document.getElementById("forgot-password-email-input").value;
    dob = document.getElementById("forgot-password-dob-input").value;
    console.log(id, email, dob);
    try {
      currentUser = await cc.getUserDetailsFromEmpIDorEmail(id, email);
      cc.closeConnection();

      if (currentUser != 0) {
        if (email == currentUser["Email"] && id == currentUser["Emp ID"] && dob == moment(currentUser["DOB"]).format("YYYY-MM-DD")) {
          console.log("matching");
          newPassword = Math.random().toString(36).slice(-8);
          passwordChanged = await cc.changePassword(id, newPassword);
          if (passwordChanged == 1) {
            sendEmail(email, 'forgot password', newPassword, id);
          } else {
            alert1("There was an error. Please try again later.");
          }
        }
      }
      document.getElementById("forgot-password-user-input").value = "";
      document.getElementById("forgot-password-email-input").value = "";
      document.getElementById("forgot-password-dob-input").value = "";
      closeModal();
      document.getElementById("password-reset-confirmation-modal").className = "modal is-active";
    }
    catch (err) {
      console.log(err);
      alert1("Error in contacting ORCUS Servers! Please try again.");
      console.log("Error in getUserDetailsFromEmpIDorEmail! Please try again.");
    }



  }

  async function getMaxID() {
    try {
      maxIDTechnician = await cc.getMaxID();
      return maxIDTechnician;
    }
    catch {
      console.log("error in getMaxID()");
      alert1("There was an error connecting to ORCUS servers. Please try again.");
    }
  }
  async function signUp() {

    var allInputs = document.getElementById("create-account-modal").getElementsByTagName("input");
    for (var i = 0; i < allInputs.length; i++) {
      if (allInputs[i].className.includes("is-success") || allInputs[i].checked == true) {

      }
      else {
        return;
      }
    }

    fname = document.getElementById("first-name-input").value;
    lname = document.getElementById("last-name-input").value;
    // cid = document.getElementById("company-input").value;
    wid = document.getElementById("workshop-input").value;
    email = document.getElementById("email-input").value;
    password = document.getElementById("password-input").value;
    dob = document.getElementById("dob-input").value;
    contactNumber = document.getElementById("contact-number-input").value;
    extraMessage = document.getElementById("extra-message-input").value;
    try {
      maxID = await getMaxID();
      console.log(fname, lname, cid, wid, email, password, dob, contactNumber, extraMessage, maxID);
      try {
        payload = {
          "fname": fname,
          "lname": lname,
          "cid": cid,
          "wid": wid,
          "email": email,
          "password": password,
          "dob": dob,
          "contactNumber": contactNumber,
          "extraMessage": extraMessage,
          "uid": maxID
        }
        done = await cc.uploadSignUpRequest(maxID, fname, lname, convertJSONToString(payload), wid);
        if (done == 1) {
          document.getElementById("generated-uid-signup").innerHTML = maxID;
          closeModal();
          document.getElementById("signup-request-confirmation-modal").className = "modal is-active";
        }
      } catch {
        console.log("error trying to uploadSignUpRequest");
        alert1("There has been an error. Please try again later.");
      }

    }
    catch {
      console.log("error trying to get max ID");
      alert1("There has been an error. Please try again later.");
    }
    // try{
    //   document.getElementById("signup-request-confirmation-modal").className = "modal is-active";
    // }
    // catch{
    //   console.log("error trying to get max ID");
    //   alert1("There has been an error. Please try again later.");
    // }
  }


  async function loginButtonPressed() {

    //console.log(cc.getAllTools(workshop_id));
    const Store = require('electron-store');
    const store = new Store();
    // store.set('Emp ID', document.getElementById("usr").value);
    // console.log(store.get('Emp ID'));
    // var email = document.getElementById("usr").value;
    store.set('currentDiv', '');
    var password = document.getElementById("pswd").value;
    var emp_id = document.getElementById("usr").value;
    if (emp_id == "") {
      document.getElementById("error-message").style.display = "inherit";
      document.getElementById("error-message").innerHTML = "Please Enter Your ID!";
    }
    else if (password == "") {
      document.getElementById("error-message").style.display = "inherit";
      document.getElementById("error-message").innerHTML = "Please Enter Your Password!";
    }
    else {
      try {
        var log = await cc.verifyLogin(emp_id, password);
        cc.closeConnection();
        console.log(log);
      }
      catch (error) {
        console.log(error)
        alert1("Error in fetching your details! Please try again.");
        console.log("Error in fetching your details! Please try again.");
      }
      if (log[0] == 1) {
        store.set('Emp ID', log[1]);
        document.location = "manager.html";
        // document.location = "https://firebasestorage.googleapis.com/v0/b/orcus-fb184.appspot.com/o/release%2Fmanagerhome.html?alt=media&token=28ed77fd-d63e-455f-b525-da20ca38fb0c";
        document.getElementById("error-message").style.display = "none";
        document.getElementById("error-message").innerHTML = "";
        console.log("success logging in");
        //getUserDetailsByEmail();
      }
      else if (log[0] == 2) {
        store.set('Emp ID', log[1]);
        document.location = 'technician.html';
        // document.location = "https://firebasestorage.googleapis.com/v0/b/orcus-fb184.appspot.com/o/release%2Fhome.html?alt=media&token=fe13356a-e819-46eb-ab01-94bf577aa0d0";
        document.getElementById("error-message").style.display = "none";
        document.getElementById("error-message").innerHTML = "";
        console.log("success logging in");
        //getUserDetailsByEmail();
      }
      else if (log[0] == 4) {
        document.getElementById("error-message").style.display = "inherit";
        document.getElementById("error-message").innerHTML = "We could not find this user. Please try again."
      }
      else if (log[0] == 5) {
        store.set('Emp ID', log[1]);
        document.location = 'issuer2.html';
        // document.location = "https://firebasestorage.googleapis.com/v0/b/orcus-fb184.appspot.com/o/release%2Fissuerpage.html?alt=media&token=36a47270-9cf3-4236-8ef5-3887911faa1f";
        //new issuer2
        // document.location = "https://firebasestorage.googleapis.com/v0/b/orcus-fb184.appspot.com/o/release%2Fissuer2.html?alt=media&token=6078b1f0-96eb-46f5-adba-066690867bb3";
        document.getElementById("error-message").style.display = "none";
        document.getElementById("error-message").innerHTML = "";
      }
      else {
        document.getElementById("error-message").style.display = "inherit";
        document.getElementById("error-message").innerHTML = "Either the user or password is incorrect. Please try again.";
      }
    }
  }
  function openCreateAccountModal() {
    document.getElementById("create-account-modal").classList.toggle("is-active");
  }
  function openForgotPasswordModal() {
    document.getElementById("forgot-password-modal").classList.toggle("is-active");
  }
  //document.location = "home.html";
  function closeModal() {
    allModals = document.getElementsByClassName("modal");
    for (var i = 0; i < allModals.length; i++) {
      allModals[i].classList.remove("is-active");
    }
  }

  function alert1(alertMessage) {
    document.getElementById("alert-modal-text").innerHTML = alertMessage;
    document.getElementById("alert-modal").classList.add("is-active");
  }

</script>
<style>
  html {
    overflow: hidden;
  }

  .clipbackground {
    background: rgb(2, 0, 36);
    background: linear-gradient(90deg, rgba(2, 0, 36, 1) 0%, rgba(1, 194, 243, 1) 0%, rgba(62, 62, 64, 1) 0%, rgba(0, 0, 0, 1) 100%);
  }

  #closebuttonsid
    {
        /* position:relative; */
        padding: 0.5em;

    }

    #closebuttonsid:hover
    {
        background-color: red;
        color: white;
    }

    #minimisebuttonsid
    {
        position:absolute;
        padding: 0.5em;
        margin-right: -15px;
    }

    #minimisebuttonsid:hover
    {
        background-color: lightgrey;
        color: white;
    }
</style>

</html>